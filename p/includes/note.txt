/**
 * Affiche tous les films enregistrés dans la base de données.
 */
function getAllMovies() {
	const xhttp = new XMLHttpRequest();

	xhttp.onload = function() {
		document.getElementById("movies").innerHTML = this.responseText;
	}

	xhttp.open("GET", "../includes/functions/movies/getAllMovies.php");
	xhttp.send();
}

/**
 * Affiche un formulaire pour éditer un film.
 * @param {string} id 
 */
function openMovieSettings(id) {
	const xhttp = new XMLHttpRequest();

	xhttp.onload = function() {
		document.getElementById(id).innerHTML = this.responseText;
	}

	xhttp.open("GET", "../includes/functions/movies/getMovieSettings.php?movie=" + id);
	xhttp.send();

	toggleVisibility(id);
}

/**
 * Ajoute dans la base de donnée un nouveau film et actualise le tableau.
 */
 function registerNewMovie() {
	const xhttp = new XMLHttpRequest();

	let f = document.getElementById("addNewMovie");
	let fData = new FormData(f);

	fData.append("name", f.elements["name"].value);

	xhttp.onload = function() {
		getAllMovies();
	}

	xhttp.open("POST", "../includes/functions/movies/registerNewMovie.php");
	xhttp.send(fData);
}

/**
 * Modifie un film.
 * @param {int} id 
 */
function modifyThisMovie(id) {
	const xhttp = new XMLHttpRequest();

	let f = document.getElementById("updateMovie" + id);
	let fData = new FormData(f);

	fData.append("name", f.elements["name"].value);

	let tags = f.elements["tags[]"];
	for (let i = 0, len = tags.length; i < len; i++) {
		if(tags[i].checked) {
			fData.append("tags[]", tags[i].value);
		}
	}

	xhttp.onload = function() {
		getAllMovies();
	}

	xhttp.open("POST", "../includes/functions/movies/modifyThisMovie.php?movie=" + id);
	xhttp.send(fData);
}

/**
 * Supprime de la base de donnée le film et actualise le tableau.
 * @param {int} id de la moviene
 */
function unregisterThisMovie(id) {
	if (window.confirm("Do you really want to unregister this movie? ")) {
		const xhttp = new XMLHttpRequest();

		xhttp.onload = function() {
			getAllMovies();
		}

		xhttp.open("GET", "../includes/functions/movies/unregisterThisMovie.php?movie=" + id);
		xhttp.send();
	}
}